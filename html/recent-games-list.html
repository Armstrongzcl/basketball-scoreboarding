<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<script type="text/javascript" src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/jquery-3.3.1.js"></script>
		<style>
			html,
			body {
				background-color: #efeff4;
			}
			
			.title {
				padding: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
				background-color: #fff;
			}
		</style>
	</head>

	<body>

		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<div class="title">
					最近比赛
				</div>
				<ul id="game" class="mui-table-view mui-table-view-chevron">
					<script>
						function openDetail(gaid) {
							mui.openWindow({
								url: "game-info.html?id=" + gaid,
							});
						}
						mui.plusReady(function() {
							plus.io.requestFileSystem(plus.io.PRIVATE_DOC, function(fs) {
								fs.root.getFile("datas/recent_games.json", {
									create: true
								}, function(file) {
									var fileReader = new plus.io.FileReader();
									fileReader.readAsText(file, "utf-8");
									fileReader.onloadend = function(e) {
										var datestr = e.target.result;
										var result;
										if(datestr == "") {
											result = [];
										} else {
											result = JSON.parse(datestr);
										}
										$.each(result, function(gaid, item) {
											$("#game").append("<li class='mui-table-view-cell'>" +
												"<div class='mui-navigate-right' id = '" + gaid + "' onclick = 'openDetail(this.id)'>" +
												"<div class='mui-row' style='text-align: center'>" +
												"<a class='' style='text-align:center'>" + item.time + "</a>" +
												"</div>" +
												"<div class='mui-row'>" +
												"<a class='mui-col-sm-5 mui-col-xs-5' style='text-align: right'>" + item.firstName + "</a>" +
												"<a class='mui-col-sm-2 mui-col-xs-2' style='text-align: center'>vs</a>" +
												"<a class='mui-col-sm-5 mui-col-xs-5' style='text-align: left'>" + item.secondName + "</a>" +
												"</div>" +
												"<div class='mui-row'>" +
												"<a class='mui-col-sm-5 mui-col-xs-5' style='text-align: right'>" + item.firstScore + "</a>" +
												"<a class='mui-col-sm-2 mui-col-xs-2' style='text-align: center'>:</a>" +
												"<a class='mui-col-sm-5 mui-col-xs-5' style='text-align: left'>" + item.secondScore + "</a>" +
												"</div>" +
												"</div>" +
												"</li>");
										});
									}
								});
							});
						});

						mui.init({
							swipeBack: false,
							pullRefresh: {
								container: '#pullrefresh',
								up: {
									callback: pullupRefresh
								}
							}
						});
						
						/**
						 * 上拉加载具体业务实现
						 */
						function pullupRefresh() {
							this.endPullupToRefresh(true|false);
						}
					</script>
				</ul>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script>
		</script>
	</body>

</html>